<!DOCTYPE html>
<html lang="en">

 <head>

   <% include ./partials/head %>
 </head>

<body>
    <!-- incluir codigo parcial de otro archivo -->
    <%- include('./partials/header') %>

   <h1 class="tituloP">Productos</h1>

   <button class="cat-toggle" id="catToggle" type="button">Categorías</button>
<div id="catOverlay" class="cat-overlay"></div>

   <% if (user && user.rol === 'admin') { %>
  <div class="top-actions">
    <a class="btn" href="/producto/crearproducto">+ Crear producto</a>
  </div>
    <% } %>



   <div class="layout">

  <aside class="sidebar" id="sidebarCats">
    <button class="cat-close" id="catClose" type="button" aria-label="Cerrar">✕</button>

    <h3>Categorías</h3>

    


    <ul>
      <li>
        <a href="/producto">Todas</a>
      </li>
      <% categorias.forEach(c => { %>
        <li>
          <a href="/producto?categoria=<%= c.id %>">
            <%= c.nombre %>
          </a>
        </li>
      <% }) %>
    </ul>
  </aside>

 <section class="grid">
  <% productos.forEach(p => { %>
    <div class="card">

      <% if (user && user.rol === 'admin') { %>
  <form class="star-form" action="/producto/destacado/<%= p.id %>" method="POST">
    <button
      type="submit"
      class="star-btn <%= p.destacado ? 'is-on' : '' %>"
      title="<%= p.destacado ? 'Quitar destacado' : 'Marcar destacado' %>">
      ★
    </button>
  </form>
<% } %>


      <a class="card-link" href="/producto/detalleproducto/<%= p.id %>">
        <% if (p.mainImg) { %>
          <img src="<%= p.mainImg.image %>" alt="<%= p.nombre %>">
        <% } %>
        <h4><%= p.nombre %></h4>
        <p>$ <%= p.precio %></p>
      </a>
      

      <% if (user && user.rol === 'admin') { %>
  <div class="card-actions">
    <a class="btn btn--ghost" href="/producto/editarproducto/<%= p.id %>">Editar</a>

    <form action="/producto/desactivar/<%= p.id %>" method="post"
          onsubmit="return confirm('¿Desactivar producto?')">
      <button type="submit" class="btn btn--danger">Desactivar</button>
    </form>


  </div>
    <% } %>
    </div>
    <% }) %>
</section>

</div>

    <section class="ultimoAgregado">
      <% if (locals.ultimoProducto !== undefined) {%>
      <p>Ultimo producto agregado: <%= locals.ultimoProducto.titulo %> </p>
      <% } %>
    </section>
    

  <%- include('./partials/footer') %>




  <script>
  (function(){
    const toggle = document.getElementById("catToggle");
    const sidebar = document.getElementById("sidebarCats");
    const overlay = document.getElementById("catOverlay");
    const closeBtn = document.getElementById("catClose");

    if (!toggle || !sidebar || !overlay) return;

    function openCats(){
      sidebar.classList.add("open");
      overlay.classList.add("activo");
    }
    function closeCats(){
      sidebar.classList.remove("open");
      overlay.classList.remove("activo");
    }

    toggle.addEventListener("click", openCats);
    overlay.addEventListener("click", closeCats);
    if (closeBtn) closeBtn.addEventListener("click", closeCats);

    sidebar.addEventListener("click", (e) => {
      if (e.target.closest("a")) closeCats();
    });

    window.addEventListener("resize", () => {
      if (window.innerWidth > 900) closeCats();
    });
  })();
</script>
</body>



</html>