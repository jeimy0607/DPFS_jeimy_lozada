<!DOCTYPE html>
<html lang="es">
<head>
  <% include ./partials/head %>
</head>

<body>
  <%- include('./partials/header') %>

  <div class="registro-caja">
    <h1>Crear cuenta</h1>

    <% if (error) { %>
      <p class="error-msg"><%= error %></p>
    <% } %>

    <% if (errors) { %>
      <ul class="form-errors">
        <% Object.values(errors).forEach(e => { %>
          <li><%= e.msg %></li>
        <% }) %>
      </ul>
    <% } %>

    <form class="form-registro" action="/registro" method="POST" enctype="multipart/form-data">

      <div class="campo">
        <label for="name">Nombre</label>
        <input
          type="text"
          id="name"
          name="name"
          value="<%= old ? old.name : '' %>"
          required
        />
        <% if (errors && errors.name) { %>
          <small class="field-error"><%= errors.name.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="lastname">Apellido</label>
        <input
          type="text"
          id="lastname"
          name="lastname"
          value="<%= old ? old.lastname : '' %>"
          required
        />
        <% if (errors && errors.lastname) { %>
          <small class="field-error"><%= errors.lastname.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="dni">Cédula</label>
        <input
          type="text"
          id="dni"
          name="dni"
          value="<%= old ? old.dni : '' %>"
          pattern="[0-9]+"
          title="La cédula solo debe contener números"
          required
        />
        <% if (errors && errors.dni) { %>
          <small class="field-error"><%= errors.dni.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="email">Correo electrónico</label>
        <input
          type="email"
          id="email"
          name="email"
          value="<%= old ? old.email : '' %>"
          required
        />
        <% if (errors && errors.email) { %>
          <small class="field-error"><%= errors.email.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="rol">Rol</label>
        <select id="rol" name="rol" required>
          <option value="comprador" <%= old && old.rol === "comprador" ? "selected" : "" %>>Comprador</option>
          <option value="admin" <%= old && old.rol === "admin" ? "selected" : "" %>>Administrador</option>
        </select>
        <% if (errors && errors.rol) { %>
          <small class="field-error"><%= errors.rol.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="password">Contraseña</label>
        <input
          type="password"
          id="password"
          name="password"
          minlength="8"
          pattern="^(?=.*[A-Za-z])(?=.*\d).{8,}$"
          title="Debe tener mínimo 8 caracteres e incluir letras y números."
          required
        />
        <% if (errors && errors.password) { %>
          <small class="field-error"><%= errors.password.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="password2">Confirmar contraseña</label>
        <input
          type="password"
          id="password2"
          name="password2"
          minlength="8"
          required
        />
        <% if (errors && errors.password2) { %>
          <small class="field-error"><%= errors.password2.msg %></small>
        <% } %>
      </div>

      <div class="campo">
        <label for="foto">Foto de perfil</label>
        <input type="file" id="foto" name="foto" accept="image/*" />
        <% if (errors && errors.foto) { %>
          <small class="field-error"><%= errors.foto.msg %></small>
        <% } %>
      </div>

      <div class="items-registro">
        <input
          type="checkbox"
          id="terms"
          name="terms"
          <%= old && old.terms ? "checked" : "" %>
          required
        />
        <label for="terms">Acepto los términos y condiciones</label>
        <% if (errors && errors.terms) { %>
          <small class="field-error"><%= errors.terms.msg %></small>
        <% } %>
      </div>

      <div class="acciones">
        <button type="submit">Crear Cuenta</button>

        <p>¿Ya tienes cuenta?
          <a href="/login" role="button">Iniciar sesión</a>
        </p>
      </div>
    </form>
  </div>

  <%- include('./partials/footer') %>

 <script src="/public/javascripts/validacionRegistro.js"></script>

</body>
</html>
